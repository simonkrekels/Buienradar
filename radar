#! /bin/sh

# Set language. Supported are: {"nl","en","fr","de"}
lang="nl"

# Set working directory in /tmp. This can be changed.
mkdir -p /tmp/radar
cd /tmp/radar

# Set icon for notification. This can also be changed.
icon="/home/simon/git/Buienradar/logo-kmi--nl.png"

# Remove old images
for file in $(ls -1v | grep .jpg); do
    if [ $(date -r ${file} +%s) -lt $(date --date="90 minutes ago" +%s) ]; then
        rm ${file}
    fi
done

# Download new images
notify-send -i ${icon} "Buienradar" "Downloading images..."
urls=$(wget -q -O - https://www.meteo.be/nl/weer/waarnemingen/neerslagradar/bliksem |\
    grep item__imag |\
    grep -o '".*"' |\
    sed -e 's/.jpg".*/.jpg/' -e 's/"//')
for url in ${urls}; do
    num=$(echo $url | sed 's/.*belRadComp//' | sed 's/.jpg//')
    if [ ! -f "belRadComp${num}.jpg" ]; then
        wget $url 
    fi
done

ls -1v | grep belRadComp | mpv -loop-playlist -really-quiet --title="Buienradar" --image-display-duration=.5 --playlist=- 
